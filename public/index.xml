<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>DNA confesses Data speak on DNA confesses Data speak</title>
    <link>/</link>
    <description>Recent content in DNA confesses Data speak on DNA confesses Data speak</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2018 Ming Tang</copyright>
    <lastBuildDate>Sun, 15 Oct 2017 00:00:00 -0400</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>How to test if two distributions are different </title>
      <link>/post/how-to-test-if-two-distributions-are-different/</link>
      <pubDate>Sat, 07 Aug 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/how-to-test-if-two-distributions-are-different/</guid>
      <description>&lt;p&gt;I asked this question on &lt;a href=&#34;https://twitter.com/tangming2005/status/1414431622141779971&#34;&gt;Twitter&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;what test to test if two distributions are different? I am aware of KS test. When n is large (which is common in genomic studies), the p-value is always significant. better to test against an effect size? how to do it in this context?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In genomics studies, it is very common to have large N (e.g., the number of introns, promoters in the genome, number of cells in the single-cell studies). A more concrete example is that one have two samples: control and treatment. one can calculate the intron retention level for each intron across the genome and ask if globally the distribution of the intron retention scores is different between the control sample and treatment sample.&lt;/p&gt;
&lt;div id=&#34;kolmogorovsmirnov-test&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Kolmogorov–Smirnov test&lt;/h3&gt;
&lt;p&gt;I am aware of the &lt;a href=&#34;https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test&#34;&gt;Kolmogorov–Smirnov test&lt;/a&gt; (K–S test or KS test).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Kolmogorov–Smirnov statistic quantifies a &lt;strong&gt;distance&lt;/strong&gt; between the empirical distribution function of the sample and the cumulative distribution function of the reference distribution, or between the empirical distribution functions of two samples.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Kolmogorov–Smirnov statistic is used in the popular &lt;a href=&#34;https://www.pnas.org/content/102/43/15545&#34;&gt;GSEA&lt;/a&gt; too.
It is good to see some examples.&lt;/p&gt;
&lt;p&gt;We will use random sampling from normal distribution as examples.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
library(patchwork)

test_distribution&amp;lt;- function(N, mean1, mean2, sd1, sd2){
  set.seed(123)
  ## random sample from normal distribution
  x&amp;lt;- rnorm(N, mean=mean1, sd = sd1)
  set.seed(234)
  y&amp;lt;- rnorm(N, mean=mean2, sd = sd2) 
  
  df&amp;lt;- data.frame(x=x, y =y)

  ## make it long format
  df&amp;lt;- df %&amp;gt;%
    pivot_longer(cols = 1:2, names_to = &amp;quot;group&amp;quot;, values_to = &amp;quot;value&amp;quot;)
  ## check the ECDF for the two distributions
  p1&amp;lt;- ggplot(df, aes(value)) + 
    stat_ecdf(geom = &amp;quot;step&amp;quot;, aes(color = group)) +
    theme_classic(base_size = 14) +
    ylab(&amp;quot;Cumulative probability&amp;quot;) +
    ggtitle(&amp;quot;ECDF for x and y&amp;quot;, subtitle = glue::glue( &amp;quot;x ~ N({mean1}, {sd1})\n y ~ N({mean2}, {sd2})&amp;quot;)) 
    
  
  p2&amp;lt;- ggplot(df, aes(x= group, y = value)) +
    geom_boxplot(aes(fill = group)) +
    theme_classic(base_size = 14) +
    ggtitle(paste0(&amp;quot;N = &amp;quot;, N))
    
  p&amp;lt;- p1 + p2
  
  ks&amp;lt;- ks.test(x,y)
  t&amp;lt;- t.test(x,y)
  return(list(ks = ks, ttest =t, p = p, df = df))

}


res&amp;lt;- test_distribution(1000, 0, 0, 1, 1)
res$p&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-07-how-to-test-if-two-distributions-are-different.en_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ks&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Two-sample Kolmogorov-Smirnov test
## 
## data:  x and y
## D = 0.025, p-value = 0.9135
## alternative hypothesis: two-sided&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;KS test showing the distribution is not significantly different which makes sense as we draw samples from the same normal distribution.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ttest&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = 0.85389, df = 1997.9, p-value = 0.3933
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.04893966  0.12442136
## sample estimates:
##   mean of x   mean of y 
##  0.01612787 -0.02161298&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Two sample t test shows that the mean is not significantly different.&lt;/p&gt;
&lt;p&gt;Let’s increase the standard deviation for the second sample to 1.2&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(1000, 0, 0, 1, 1.2)
res$p&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-07-how-to-test-if-two-distributions-are-different.en_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ks&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Two-sample Kolmogorov-Smirnov test
## 
## data:  x and y
## D = 0.053, p-value = 0.1205
## alternative hypothesis: two-sided&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ttest&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = 0.86215, df = 1939.5, p-value = 0.3887
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.05362088  0.13774778
## sample estimates:
##   mean of x   mean of y 
##  0.01612787 -0.02593558&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s increase the sample size&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(10000, 0, 0, 1, 1.2)
res$p&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-07-how-to-test-if-two-distributions-are-different.en_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ks&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Two-sample Kolmogorov-Smirnov test
## 
## data:  x and y
## D = 0.0497, p-value = 3.746e-11
## alternative hypothesis: two-sided&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ttest&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = 0.19585, df = 19342, p-value = 0.8447
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.02758649  0.03371124
## sample estimates:
##    mean of x    mean of y 
## -0.002371702 -0.005434073&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After we increase the sample size, t-test which tests against mean is still not significant. However, the KS test becomes highly significant even the samples are drew from the same two distributions as the last comparison!!&lt;/p&gt;
&lt;p&gt;Let’s try another example with very small difference (small here is subjective, one has to decide it under the experiment context) of means.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(1000, 0, 0.1, 1, 1)
res$p&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-07-how-to-test-if-two-distributions-are-different.en_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ks&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Two-sample Kolmogorov-Smirnov test
## 
## data:  x and y
## D = 0.054, p-value = 0.1083
## alternative hypothesis: two-sided&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ttest&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = -1.4086, df = 1997.9, p-value = 0.1591
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.14893966  0.02442136
## sample estimates:
##  mean of x  mean of y 
## 0.01612787 0.07838702&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s increase the sample size to &lt;code&gt;10000&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(10000, 0, 0.1, 1, 1)
res$p&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-07-how-to-test-if-two-distributions-are-different.en_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ks&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Two-sample Kolmogorov-Smirnov test
## 
## data:  x and y
## D = 0.0502, p-value = 2.273e-11
## alternative hypothesis: two-sided&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$ttest&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = -6.914, df = 19998, p-value = 4.853e-12
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.12558133 -0.07010528
## sample estimates:
##    mean of x    mean of y 
## -0.002371702  0.095471606&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Suddenly, both the KS test and t-test becomes highly significant after increasing the sample size.
That’s why we should not put too much emphasis on the p-values, but also check the effect size. Many genomic papers show highly significant p values &amp;lt; 2.22e−16 (smallest you can get from &lt;code&gt;R&lt;/code&gt;) simply because the sample size is really big (I have to confess that I have it too in my papers because my PI/reviewers asked).&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;earth-mover-distance-emd&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;earth mover distance (EMD)&lt;/h3&gt;
&lt;p&gt;Others in the tweet thread mentioned &lt;a href=&#34;https://en.wikipedia.org/wiki/Earth_mover%27s_distance&#34;&gt;earth mover distance&lt;/a&gt; that can be used to measure the distance between two distributions. There is a biconductor package for calculating it. The &lt;a href=&#34;https://www.bioconductor.org/packages/release/bioc/html/EMDomics.html&#34;&gt;EMDomics&lt;/a&gt; algorithm is used to perform a supervised multi-class analysis to measure the magnitude and statistical significance of observed continuous genomics data between groups.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(EMDomics)


calculate_EMD&amp;lt;- function(df){
  num&amp;lt;- 1:nrow(df)
  exp_data&amp;lt;- df$value
  names(exp_data)&amp;lt;- glue::glue(&amp;quot;sample_{num}&amp;quot;)
  labels&amp;lt;- df$group
  names(labels)&amp;lt;- names(exp_data)
  calculate_emd_gene(exp_data, labels, names(exp_data))
}

res&amp;lt;- test_distribution(1000, 0, 0, 1, 1.2)
calculate_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.7629998&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## increase the sample size 
res&amp;lt;- test_distribution(10000, 0, 0, 1, 1.2)
calculate_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.8505&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(1000, 0, 0.1, 1, 1)
calculate_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.3919999&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res$df %&amp;gt;% head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 2
##   group  value
##   &amp;lt;chr&amp;gt;  &amp;lt;dbl&amp;gt;
## 1 x     -0.560
## 2 y      0.761
## 3 x     -0.230
## 4 y     -1.95 
## 5 x      1.56 
## 6 y     -1.40&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(10000, 0, 0.1, 1, 1)
calculate_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.4892001&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Two observations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EMD between &lt;span class=&#34;math inline&#34;&gt;\(N(0,1)\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(N(0.1,1)\)&lt;/span&gt; is smaller than EMD between &lt;span class=&#34;math inline&#34;&gt;\(N(0,1)\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(N(0,1.2)\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;increasing the sample size will increase the EMD too!&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;The EMD score increases as the distributions become increasingly dissimilar, but we have no framework for estimating the significance of a particular EMD score. EMDomics uses a permutation-based method to calculate a q-value that is interpreted analogously to a p-value.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The &lt;code&gt;EMDomics&lt;/code&gt; packages implemented the permutation test for multiple genes. Let me do it for a single gene.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(1000, 0, 0, 1, 1.2)
res$df&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2,000 x 2
##    group   value
##    &amp;lt;chr&amp;gt;   &amp;lt;dbl&amp;gt;
##  1 x     -0.560 
##  2 y      0.793 
##  3 x     -0.230 
##  4 y     -2.46  
##  5 x      1.56  
##  6 y     -1.80  
##  7 x      0.0705
##  8 y      1.77  
##  9 x      0.129 
## 10 y      1.75  
## # … with 1,990 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;calculate_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.7629998&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## random shuffle the x, y group designation and calculate the EMD score
permutation_EMD&amp;lt;- function(d){
  set.seed(NULL)
  d$group&amp;lt;- sample(d$group)
  calculate_EMD(d)
}

permutation_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.165&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## a different shuffle gives a different EMD
permutation_EMD(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.511&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## permutate N times and calculate how many times the permutated EMD is bigger than the EMD
## for the original data and that&amp;#39;s the p-value

permutation_EMD_pvalue&amp;lt;- function(d, N_permutation = 1000){
  permutation_EMDs&amp;lt;- replicate(N_permutation, permutation_EMD(d))
  ### p-value
  mean(calculate_EMD(d) &amp;lt; permutation_EMDs)
}

permutation_EMD_pvalue(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.003&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The p-value is &amp;lt; 0.05 which suggests that the two distributions are significantly different.&lt;/p&gt;
&lt;p&gt;If we sample from the same &lt;span class=&#34;math inline&#34;&gt;\(N(0,1)\)&lt;/span&gt; distribution:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;res&amp;lt;- test_distribution(1000, 0, 0, 1, 1)
permutation_EMD_pvalue(res$df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.602&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;p-value is not significant.&lt;/p&gt;
&lt;p&gt;In fact, many people suggested using a permutation based method to evaluate the significance of the distribution differences using the KS test. The below code snippet is from &lt;a href=&#34;https://twitter.com/jma1991&#34;&gt;James&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/permutation_ks.jpeg&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;comparing-groups-of-distributions&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Comparing groups of distributions&lt;/h3&gt;
&lt;p&gt;For scRNAseq or CyTOF data, if one has treatment vs control groups, 3 samples each, each sample contains 1000 cells. How to test if the treatment changes the expression of a certain gene? This is an example of multi-sample, multi-group single-cell differential analysis. Pseudo-bulk method can be used as in the &lt;a href=&#34;https://www.nature.com/articles/s41467-020-19894-4&#34;&gt;muscat&lt;/a&gt;. Note that it is different from marker gene identification where differential gene expression is carried out between clusters of cells.&lt;/p&gt;
&lt;p&gt;Papers to read:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://genomebiology.biomedcentral.com/articles/10.1186/s13059-015-0679-0&#34;&gt;quantro: a data-driven approach to guide the choice of an appropriate normalization method&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://academic.oup.com/bioinformatics/advance-article/doi/10.1093/bioinformatics/btab226/6207964&#34;&gt;Fast identification of differential distributions in single-cell RNA-sequencing data with waddR&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://www.biorxiv.org/content/10.1101/2020.11.24.394213v3.full&#34;&gt;distinct: a novel approach to differential distribution analyses&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Rafa, our department chair asked a good question:&lt;/p&gt;
&lt;blockquote class=&#34;twitter-tweet&#34;&gt;
&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;
First I would ask why is testing for a difference in mean and a difference in SD not enough? Can you construct examples of two distributions with the same mean and same SD but different in a meaningful way in your context? Seeing these examples will help motivate a solution.
&lt;/p&gt;
— Rafael Irizarry (&lt;span class=&#34;citation&#34;&gt;@rafalab&lt;/span&gt;) &lt;a href=&#34;https://twitter.com/rafalab/status/1415110253549690882?ref_src=twsrc%5Etfw&#34;&gt;July 14, 2021&lt;/a&gt;
&lt;/blockquote&gt;
&lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;p&gt;Figure 7 b from the &lt;code&gt;distinct&lt;/code&gt; paper shows some genes have different distributions but have the same mean across groups.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/distinct_example.png&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Reprogramming of bivalent chromatin states in NRAS mutant melanoma suggests PRC2 inhibition as a therapeutic strategy</title>
      <link>/publication/2021-07-20-melanoma-chromatin-state/</link>
      <pubDate>Tue, 20 Jul 2021 00:00:00 -0400</pubDate>
      
      <guid>/publication/2021-07-20-melanoma-chromatin-state/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>HieRFIT: A hierarchical cell type classification tool for projections from complex single-cell atlas datasets </title>
      <link>/publication/2021-07-13-hierfit/</link>
      <pubDate>Tue, 13 Jul 2021 00:00:00 -0400</pubDate>
      
      <guid>/publication/2021-07-13-hierfit/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Chromatin state dynamics confers specific therapeutic strategies in enhancer subtypes of colorectal cancer</title>
      <link>/publication/2021-05-30-chromatin-state-colorectal-cancer/</link>
      <pubDate>Sun, 30 May 2021 00:00:00 -0400</pubDate>
      
      <guid>/publication/2021-05-30-chromatin-state-colorectal-cancer/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Fast analysis of scATAC-seq data using a predefined set of genomic regions</title>
      <link>/talk/2021-fast-scatacseq/</link>
      <pubDate>Fri, 23 Apr 2021 10:00:00 -0400</pubDate>
      
      <guid>/talk/2021-fast-scatacseq/</guid>
      <description>&lt;p&gt;I am invited by Henry Rong in &lt;a href=&#34;http://cfce.dfci.harvard.edu/&#34; target=&#34;_blank&#34;&gt;Center for Functional Cancer Epigenomics&lt;/a&gt; (CFCE)  at Dana-Farber to give a presentation on &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/publication/2020-03-20-kallisto-scatac/&#34; target=&#34;_blank&#34;&gt;Fast analysis of scATAC-seq data using a predefined set of genomic regions&lt;/a&gt;. This project was a enjoyable collabration with &lt;a href=&#34;https://research.hsr.it/en/centers/omics-sciences/innovation-lab/davide-cittaro.html&#34; target=&#34;_blank&#34;&gt;Davide Cittaro&lt;/a&gt; at San Raffaele Scientific Institute in Italy.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>STAT115 single cell ATACseq lecture</title>
      <link>/talk/2021-stat115-scrnaseq-lecture/</link>
      <pubDate>Tue, 30 Mar 2021 12:00:00 -0400</pubDate>
      
      <guid>/talk/2021-stat115-scrnaseq-lecture/</guid>
      <description>&lt;p&gt;I gave a guest lecture on single cell ATACseq for &lt;a href=&#34;https://canvas.harvard.edu/courses/49497/assignments/syllabus&#34; target=&#34;_blank&#34;&gt;STAT115&lt;/a&gt; to the Harvard students. The videos can be found at &lt;a href=&#34;https://liulab-dfci.github.io/bioinfo-combio/scatac.html&#34; target=&#34;_blank&#34;&gt;https://liulab-dfci.github.io/bioinfo-combio/scatac.html&lt;/a&gt;. slides can be found in the PDF as well. Shirley has put all her course videos in the above bookdown. Great resource for Bioinformatics!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>CHIPS: A Snakemake pipeline for quality control and reproducible processing of chromatin profiling data</title>
      <link>/publication/2021-03-11-chips-snakemake/</link>
      <pubDate>Wed, 10 Mar 2021 00:00:00 -0500</pubDate>
      
      <guid>/publication/2021-03-11-chips-snakemake/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>clustered dotplot for single-cell RNAseq</title>
      <link>/post/clustered-dotplot-for-single-cell-rnaseq/</link>
      <pubDate>Wed, 10 Mar 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/clustered-dotplot-for-single-cell-rnaseq/</guid>
      <description>&lt;p&gt;Dotplot is a nice way to visualize scRNAseq expression data across clusters. It gives information (by color) for the average expression level across cells within the cluster and the percentage (by size of the dot) of the cells express that gene within the cluster.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Seurat&lt;/code&gt; has a nice function for that. However, it can not do the clustering for the rows and columns. David McGaughey has written a &lt;a href=&#34;http://davemcg.github.io/post/lets-plot-scrna-dotplots/&#34;&gt;blog post&lt;/a&gt; using ggplot2 and ggtree from Guangchuang Yu. It looks great!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/clustered_dotplot.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;In this post, I am trying to reproduce the same effect using &lt;a href=&#34;https://jokergoo.github.io/ComplexHeatmap-reference/book/&#34;&gt;ComplexHeatmap&lt;/a&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(Seurat)
library(tidyverse)
library(presto)
library(ComplexHeatmap)
library(circlize)
# Load the PBMC dataset
pbmc.data &amp;lt;- Read10X(data.dir = &amp;quot;~/Downloads/filtered_gene_bc_matrices/hg19/&amp;quot;)
pbmc &amp;lt;- CreateSeuratObject(counts = pbmc.data, project = &amp;quot;pbmc3k&amp;quot;, min.cells = 3, min.features = 200)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;standard-processing&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;standard processing&lt;/h3&gt;
&lt;p&gt;following &lt;a href=&#34;https://satijalab.org/seurat/articles/pbmc3k_tutorial.html&#34; class=&#34;uri&#34;&gt;https://satijalab.org/seurat/articles/pbmc3k_tutorial.html&lt;/a&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;pbmc[[&amp;quot;percent.mt&amp;quot;]] &amp;lt;- PercentageFeatureSet(pbmc, pattern = &amp;quot;^MT-&amp;quot;)

## ScaleData uses top variable genes only
pbmc&amp;lt;- pbmc %&amp;gt;% 
  NormalizeData(normalization.method = &amp;quot;LogNormalize&amp;quot;, scale.factor = 10000) %&amp;gt;%
  FindVariableFeatures(selection.method = &amp;quot;vst&amp;quot;, nfeatures = 2000) %&amp;gt;%
  ScaleData() %&amp;gt;%
  RunPCA() %&amp;gt;%
  FindNeighbors(dims = 1:10) %&amp;gt;%
  FindClusters(resolution = 0.5) %&amp;gt;%
  RunUMAP(dims = 1:10)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck
## 
## Number of nodes: 2700
## Number of edges: 97958
## 
## Running Louvain algorithm...
## Maximum modularity in 10 random starts: 0.8717
## Number of communities: 9
## Elapsed time: 0 seconds&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DimPlot(pbmc, reduction = &amp;quot;umap&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;new.cluster.ids &amp;lt;- c(&amp;quot;Naive CD4 T&amp;quot;, &amp;quot;CD14+ Mono&amp;quot;, &amp;quot;Memory CD4 T&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;CD8 T&amp;quot;, &amp;quot;FCGR3A+ Mono&amp;quot;, 
    &amp;quot;NK&amp;quot;, &amp;quot;DC&amp;quot;, &amp;quot;Platelet&amp;quot;)
names(new.cluster.ids) &amp;lt;- levels(pbmc)
pbmc &amp;lt;- RenameIdents(pbmc, new.cluster.ids)
DimPlot(pbmc, reduction = &amp;quot;umap&amp;quot;, label = TRUE, pt.size = 0.5) + NoLegend()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;find-marker-genes&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;find marker genes&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;markers&amp;lt;- presto::wilcoxauc(pbmc, &amp;#39;seurat_clusters&amp;#39;, assay = &amp;#39;data&amp;#39;)
markers&amp;lt;- top_markers(markers, n = 10, auc_min = 0.5, pct_in_min = 20, pct_out_max = 20)

markers&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 10
##     rank `0`      `1`    `2`    `3`      `4`   `5`         `6`   `7`     `8`    
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;  
##  1     1 CCR7     S100A8 AQP3   CD79A    GZMA  FCGR3A      GZMB  FCER1A  PPBP   
##  2     2 PIK3IP1  FCN1   TRAT1  CD79B    CST7  IFITM3      PRF1  CLEC10A NRGN   
##  3     3 PRKCQ-A… LGALS2 SPOCK2 MS4A1    GZMK  RP11-290F2… GNLY  HLA-DQ… PF4    
##  4     4 LEF1     CFD    CD27   HLA-DQA1 LYAR  CFD         FGFB… CPVL    SDPR   
##  5     5 TCF7     GRN    TRADD  HLA-DQB1 GZMM  MS4A7       CST7  HLA-DMB GNG11  
##  6     6 CD27     MS4A6A CD3G   TCL1A    CD8A  CD68        GZMA  CD33    SPARC  
##  7     7 MAL      AP1S2  RGCC   LINC009… KLRG1 SPI1        FCGR… CTSH    RGS18  
##  8     8 RGCC     CD14   CD40LG HLA-DMA  PRF1  RHOC        SPON2 RNASE6  HIST1H…
##  9     9 CD3G     CD68   LAT    VPREB3   GZMH  HCK         CCL4  KLF4    TPM4   
## 10    10 LDLRAP1  LGALS3 FLT3LG HLA-DQA2 HOPX  IFI30       APMAP RNF130  GP9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;all_markers&amp;lt;- markers %&amp;gt;%
  select(-rank) %&amp;gt;% 
  unclass() %&amp;gt;% 
  stack() %&amp;gt;%
  pull(values) %&amp;gt;%
  unique() %&amp;gt;%
   .[!is.na(.)]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Seurat’s dot plot&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;p&amp;lt;- DotPlot(object = pbmc, features = all_markers)
p&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;lets-reproduce-it-using-complexheatmap&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Let’s reproduce it using Complexheatmap&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df&amp;lt;- p$data
head(df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##            avg.exp  pct.exp features.plot          id avg.exp.scaled
## CCR7      2.993317 43.41534          CCR7 Naive CD4 T       2.337223
## PIK3IP1   2.674179 42.11288       PIK3IP1 Naive CD4 T       1.844182
## PRKCQ-AS1 2.167078 33.28509     PRKCQ-AS1 Naive CD4 T       2.123716
## LEF1      2.003597 31.83792          LEF1 Naive CD4 T       2.027023
## TCF7      2.253631 37.48191          TCF7 Naive CD4 T       1.773285
## CD27      2.326533 39.07381          CD27 Naive CD4 T       1.210923&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;### the matrix for the scaled expression 
exp_mat&amp;lt;-df %&amp;gt;% 
  select(-pct.exp, -avg.exp) %&amp;gt;%  
  pivot_wider(names_from = id, values_from = avg.exp.scaled) %&amp;gt;% 
  as.data.frame() 
    
row.names(exp_mat) &amp;lt;- exp_mat$features.plot  
exp_mat &amp;lt;- exp_mat[,-1] %&amp;gt;% as.matrix()

head(exp_mat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##           Naive CD4 T          B Memory CD4 T FCGR3A+ Mono         NK
## CCR7         2.337223  0.4065916    0.6473101   -0.5357480 -0.6116367
## PIK3IP1      1.844182 -0.2277953    1.4179422   -0.6531667 -0.1884663
## PRKCQ-AS1    2.123716 -0.6830185    1.0323842   -0.5907663  0.0349381
## LEF1         2.027023 -0.5746819    1.4350437   -0.5707971 -0.4876044
## TCF7         1.773285 -0.4479782    1.5832831   -0.5337908 -0.6645233
## CD27         1.210923 -0.2029260    1.3852365   -0.7374133 -0.6415774
##                CD8 T CD14+ Mono         DC   Platelet
## CCR7      -0.4272161 -0.5827381 -0.5508353 -0.6829502
## PIK3IP1    0.2223521 -0.8180393 -0.9991901 -0.5978184
## PRKCQ-AS1  0.2375921 -0.6732668 -0.7407892 -0.7407892
## LEF1      -0.3271094 -0.4091405 -0.7288104 -0.3639229
## TCF7       0.2798941 -0.5843243 -0.6207981 -0.7850477
## CD27       1.3328521 -0.7261509 -0.7919650 -0.8289795&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## the matrix for the percentage of cells express a gene

percent_mat&amp;lt;-df %&amp;gt;% 
  select(-avg.exp, -avg.exp.scaled) %&amp;gt;%  
  pivot_wider(names_from = id, values_from = pct.exp) %&amp;gt;% 
  as.data.frame() 
    
row.names(percent_mat) &amp;lt;- percent_mat$features.plot  
percent_mat &amp;lt;- percent_mat[,-1] %&amp;gt;% as.matrix()

head(percent_mat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##           Naive CD4 T         B Memory CD4 T FCGR3A+ Mono        NK     CD8 T
## CCR7         43.41534 15.759312     26.37131     5.095541  2.702703  4.747774
## PIK3IP1      42.11288 13.180516     40.92827    12.738854 13.513514 18.694362
## PRKCQ-AS1    33.28509  1.146132     29.53586     4.458599 11.486486 13.353116
## LEF1         31.83792  2.578797     32.27848     3.821656  4.054054  5.341246
## TCF7         37.48191  9.169054     36.91983    17.197452  8.108108 18.991098
## CD27         39.07381 12.034384     45.14768     4.458599  4.729730 25.816024
##           CD14+ Mono        DC Platelet
## CCR7        2.434077  8.333333 0.000000
## PIK3IP1     6.693712  2.777778 6.666667
## PRKCQ-AS1   1.419878  0.000000 0.000000
## LEF1        5.070994  0.000000 6.666667
## TCF7        9.736308 16.666667 6.666667
## CD27        3.042596  2.777778 0.000000&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## the range is from 0 - 100
range(percent_mat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1]   0 100&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## these two matrix have the same dimension
dim(exp_mat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 80  9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dim(percent_mat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 80  9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(viridis)
library(Polychrome)

Polychrome::swatch(viridis(20))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## get an idea of the ranges of the matrix
quantile(exp_mat, c(0.1, 0.5, 0.9, 0.99))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##        10%        50%        90%        99% 
## -0.6695752 -0.3567907  1.7156356  2.5000000&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## any value that is greater than 2 will be mapped to yellow
col_fun = circlize::colorRamp2(c(-1, 0, 2), viridis(20)[c(1,10, 20)])


cell_fun = function(j, i, x, y, w, h, fill){
          grid.rect(x = x, y = y, width = w, height = h, 
                    gp = gpar(col = NA, fill = NA))
          grid.circle(x=x,y=y,r= percent_mat[i, j]/100 * min(unit.c(w, h)),
                      gp = gpar(fill = col_fun(exp_mat[i, j]), col = NA))}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## also do a kmeans clustering for the genes with k = 4
Heatmap(exp_mat,
        heatmap_legend_param=list(title=&amp;quot;expression&amp;quot;),
        column_title = &amp;quot;clustered dotplot&amp;quot;, 
        col=col_fun,
        rect_gp = gpar(type = &amp;quot;none&amp;quot;),
        cell_fun = cell_fun,
        row_names_gp = gpar(fontsize = 5),
        row_km = 4,
        border = &amp;quot;black&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;It looks pretty decent. One can now take advantage of all the awesome annotation function to add annotation bars in complexheatmap.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;colnames(exp_mat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Naive CD4 T&amp;quot;  &amp;quot;B&amp;quot;            &amp;quot;Memory CD4 T&amp;quot; &amp;quot;FCGR3A+ Mono&amp;quot; &amp;quot;NK&amp;quot;          
## [6] &amp;quot;CD8 T&amp;quot;        &amp;quot;CD14+ Mono&amp;quot;   &amp;quot;DC&amp;quot;           &amp;quot;Platelet&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(RColorBrewer)
cluster_anno&amp;lt;-  c(&amp;quot;CD4T&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;CD4T&amp;quot;, &amp;quot;Mono&amp;quot;, &amp;quot;NK&amp;quot;, &amp;quot;CD8T&amp;quot;, &amp;quot;CD14_Mono&amp;quot;, &amp;quot;DC&amp;quot;, &amp;quot;Platelet&amp;quot;)

column_ha&amp;lt;- HeatmapAnnotation(
    cluster_anno = cluster_anno,
    col = list(cluster_anno = setNames(brewer.pal(8, &amp;quot;Paired&amp;quot;), unique(cluster_anno))
    ),
    na_col = &amp;quot;grey&amp;quot;
)

Heatmap(exp_mat,
        heatmap_legend_param=list(title=&amp;quot;expression&amp;quot;),
        column_title = &amp;quot;clustered dotplot&amp;quot;, 
        col=col_fun,
        rect_gp = gpar(type = &amp;quot;none&amp;quot;),
        cell_fun = cell_fun,
        row_names_gp = gpar(fontsize = 5),
        row_km = 4,
        border = &amp;quot;black&amp;quot;,
        top_annotation = column_ha)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;update&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;UPDATE&lt;/h3&gt;
&lt;p&gt;Zuguang mentioned: &lt;a href=&#34;https://twitter.com/jokergoo_gu/status/1372941312622743558&#34; class=&#34;uri&#34;&gt;https://twitter.com/jokergoo_gu/status/1372941312622743558&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Alternatively you can use &lt;code&gt;layer_fun&lt;/code&gt; which is a vectorized version of &lt;code&gt;cell_fun&lt;/code&gt;. It will speed up plotting in interactive graphics devices. Just change &lt;code&gt;percent_mat[i, j]&lt;/code&gt; to &lt;code&gt;pindex(percent_mat, i, j)&lt;/code&gt; and keep other code unchanged, and assign to &lt;code&gt;layer_fun&lt;/code&gt; argument.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;One can also create a legend for the dot size for the percentages. &lt;a href=&#34;https://jokergoo.github.io/ComplexHeatmap-reference/book/legends.html#add-customized-legends&#34; class=&#34;uri&#34;&gt;https://jokergoo.github.io/ComplexHeatmap-reference/book/legends.html#add-customized-legends&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;I think for points, it might be the diameter. &lt;code&gt;size&lt;/code&gt; is directly passed to &lt;code&gt;grid.points()&lt;/code&gt; so it should mean the size of an arbitrary symbol.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Later, he confirmed that the size of points generated by grid.points(size = 10) is different from that from grid.circle(r=5)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;For your case, I would suggest to also use grid.points in your layer_fun.
If you use grid.circle in layer_fun, then you also need to use grid.circle to construct legend, which is a little bit complicated. You need to set &lt;code&gt;graphics&lt;/code&gt; argument in Legend()&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;See the last example in Section 5.2. &lt;a href=&#34;https://jokergoo.github.io/ComplexHeatmap-reference/book/legends.html#discrete-legends&#34; class=&#34;uri&#34;&gt;https://jokergoo.github.io/ComplexHeatmap-reference/book/legends.html#discrete-legends&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div id=&#34;use-grid.circle-in-both-the-heatmap-body-and-the-legend&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;use grid.circle() in both the heatmap body and the legend&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## To make the size of the dot in the heatmap body comparable to the legend, I used fixed
## size unit.(2, &amp;quot;mm) rather than min(unit.c(w, h).

layer_fun = function(j, i, x, y, w, h, fill){
          grid.rect(x = x, y = y, width = w, height = h, 
                    gp = gpar(col = NA, fill = NA))
          grid.circle(x=x,y=y,r= pindex(percent_mat, i, j)/100 * unit(2, &amp;quot;mm&amp;quot;),
                      gp = gpar(fill = col_fun(pindex(exp_mat, i, j)), col = NA))}


lgd_list = list(
    Legend( labels = c(0,0.25,0.5,0.75,1), title = &amp;quot;pt&amp;quot;,
            graphics = list(
              function(x, y, w, h) grid.circle(x = x, y = y, r = 0 * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = 0.25 * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = 0.5 * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = 0.75 * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = 1 * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)))
            ))

set.seed(123)    
hp&amp;lt;- Heatmap(exp_mat,
        heatmap_legend_param=list(title=&amp;quot;expression&amp;quot;),
        column_title = &amp;quot;clustered dotplot&amp;quot;, 
        col=col_fun,
        rect_gp = gpar(type = &amp;quot;none&amp;quot;),
        layer_fun = layer_fun,
        row_names_gp = gpar(fontsize = 5),
        row_km = 4,
        border = &amp;quot;black&amp;quot;,
        top_annotation = column_ha)

draw( hp, annotation_legend_list = lgd_list)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Note that, we use the percentage as the radius of the circle. The area of the dot is &lt;code&gt;pi *r^2&lt;/code&gt;.
It will appear 4 times different if the original percentage is 0.5 versus 1 (2 times difference) which may not be desirable.
see &lt;a href=&#34;https://stackoverflow.com/questions/64067450/does-size-for-ggplot2geom-point-refer-to-radius-diameter-area-or-somethin&#34; class=&#34;uri&#34;&gt;https://stackoverflow.com/questions/64067450/does-size-for-ggplot2geom-point-refer-to-radius-diameter-area-or-somethin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We can do a square root of the radius:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;layer_fun1 = function(j, i, x, y, w, h, fill){
          grid.rect(x = x, y = y, width = w, height = h, 
                    gp = gpar(col = NA, fill = NA))
          grid.circle(x=x,y=y,r= sqrt(pindex(percent_mat, i, j)/100)  * unit(2, &amp;quot;mm&amp;quot;),
                      gp = gpar(fill = col_fun(pindex(exp_mat, i, j)), col = NA))}

lgd_list1 = list(
    Legend( labels = c(0,0.25,0.5,0.75,1), title = &amp;quot;pt&amp;quot;,
            graphics = list(
              function(x, y, w, h) grid.circle(x = x, y = y, r = 0  * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = sqrt(0.25) * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = sqrt(0.5) * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = sqrt(0.75) * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)),
              function(x, y, w, h) grid.circle(x = x, y = y, r = 1 * unit(2, &amp;quot;mm&amp;quot;),
                                               gp = gpar(fill = &amp;quot;black&amp;quot;)))
            ))

set.seed(123)    
hp1&amp;lt;- Heatmap(exp_mat,
        heatmap_legend_param=list(title=&amp;quot;expression&amp;quot;),
        column_title = &amp;quot;clustered dotplot&amp;quot;, 
        col=col_fun,
        rect_gp = gpar(type = &amp;quot;none&amp;quot;),
        layer_fun = layer_fun1,
        row_names_gp = gpar(fontsize = 5),
        row_km = 4,
        border = &amp;quot;black&amp;quot;,
        top_annotation = column_ha)

draw( hp1, annotation_legend_list = lgd_list1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;use-grid.points-in-both-the-heatmap-body-and-the-legend&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;use grid.points() in both the heatmap body and the legend&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## note for grid.points, use col for the filling color of the points, while in grid.circle, use fill for the filling color of the circle. I should learn more about {grid}

layer_fun2 = function(j, i, x, y, w, h, fill){
          grid.rect(x = x, y = y, width = w, height = h, 
                    gp = gpar(col = NA, fill = NA))
          grid.points(x = x, y = y, 
                     gp = gpar(col = col_fun(pindex(exp_mat, i, j))),
                     size = pindex(percent_mat, i, j)/100 * unit(4, &amp;quot;mm&amp;quot;),
                     pch = 16
                    )
}


lgd_list2 = list(
    Legend( labels = c(0,0.25,0.5,0.75,1), title = &amp;quot;pt&amp;quot;, type = &amp;quot;points&amp;quot;, pch = 16, size = c(0,0.25,0.5,0.75,1) * unit(4,&amp;quot;mm&amp;quot;),
        legend_gp = gpar(col = &amp;quot;black&amp;quot;)))

set.seed(123)
hp2&amp;lt;- Heatmap(exp_mat,
        heatmap_legend_param=list(title=&amp;quot;expression&amp;quot;),
        column_title = &amp;quot;clustered dotplot&amp;quot;, 
        col=col_fun,
        rect_gp = gpar(type = &amp;quot;none&amp;quot;),
        layer_fun = layer_fun2,
        row_names_gp = gpar(fontsize = 5),
        row_km = 4,
        border = &amp;quot;black&amp;quot;,
        top_annotation = column_ha)

draw( hp2, annotation_legend_list = lgd_list2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-03-10-clustered-dotplot-for-single-cell-rnaseq.en_files/figure-html/unnamed-chunk-13-1.png&#34; width=&#34;1152&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;conclusion&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;I would use &lt;code&gt;grid.circle&lt;/code&gt; to draw the dots in the legend and the heatmap body since I can fine-tune the looking of the dot size. I am not entirely sure how the size argument determines the size of the dots in &lt;code&gt;grid.points(size)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Again, thanks &lt;a href=&#34;https://twitter.com/jokergoo_gu&#34;&gt;Zuguang Gu&lt;/a&gt; for this awesome package!!&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Precious lessons I learned from my Mom</title>
      <link>/post/precious-lessons-i-learned-from-my-mom/</link>
      <pubDate>Mon, 25 Jan 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/precious-lessons-i-learned-from-my-mom/</guid>
      <description>&lt;p&gt;I never have thought that my first blog post in 2021 would be non-technical. I shared this personal story on LinkedIn and want to make it a blog post.&lt;/p&gt;

&lt;p&gt;I want to share how our beings are shaped by our life experiences. Let me take myself as an example. I grew up in a low-income family in China, but I inherited tremendous riches from my Mom in terms of precious characters. She taught me several things that money can&amp;rsquo;t buy.&lt;/p&gt;

&lt;p&gt;First of all, honesty and integrity. When I was in primary school, I stole a five Chinese dollar bill and wanted to buy snacks. I put it under the pillow, but I could not fall asleep. I was so nervous that I could even hear my own heartbeats. My Mom found it out and was really mad at me. She punished me by kneeling on a washing board. It may not seem to be appropriate physical punishment; however, I learned that I could not steal, and I need to be an honest person. I have such a deep impression that I remember it so clearly even today. Later, there are many temptations in my life, but honesty is the limit that I never passed.&lt;/p&gt;

&lt;p&gt;Second, grit and persistence. My mom used to work as a shoe mender and had a shabby booth by the street. It was scorching in the summer and freezing in the winter. Life had been harsh, but she worked hard and made ends meet for the whole family. Meanwhile, she saved my Dad&amp;rsquo;s salary for our tuition fees. What added insult to injury is that she was later diagnosed with tuberculosis and could not even get up for a few months. Again, she showed her persistence and finally recovered. She reminded me often that only knowledge can change my destine. She was very stingy with herself, but when I wanted some money to buy books, to attend workshops, she never hesitated to pay for them. All those things have a profound impact on me. I studied diligently and did not let her down. I ranked #1 in our county in the high-school entrance exam. I still remember her tears of joy when we got the news. Life always has ups and downs. Three years later, I didn&amp;rsquo;t do well in the college entrance exam and was admitted to a middle-ranked key university. I was in a dilemma, should I go to university or should I go back to study and take the exam next year again. My Mom encouraged me to stay, and I am glad I took her advice and made the optimal decision. To be honest, it was not easy. Some of my classmates stayed but eventually went to university before the deadline. Eventually, my efforts got paid off. I ranked #5 in the county the next year and went to a much better university, which changed my life trajectory. The university has an excellent culture to go abroad to study. I was saturated in such an ideal environment to prepare for English tests and apply for graduate schools.&lt;/p&gt;

&lt;p&gt;On August 8th, 2008, I flew to the US to pursue a Ph.D., writing another chapter of life in English like many of you. It was the first time in my life I got enough stipend to support myself and even saved $50,000 during my Ph.D. I gave them all to my parents to buy an apartment in China. That&amp;rsquo;s the best investment I have ever made! I was grateful to my parents and also proud of myself.&lt;/p&gt;

&lt;p&gt;When I look back, my Mom has passed many precious characters to me: kindness to people, humbleness, a high standard of working ethic, keeping my words and delivering the commitments, etc. When I have setbacks, I can boast about my resilience because I now see every failure as a good learning opportunity to make me a better human. Of course, she was restricted by her background, and her view of things has some limitations. However, those essential qualities have paved a solid foundation for my life and work.&lt;/p&gt;

&lt;p&gt;Many years later, I got married; I went to work, and I am a father of two. All those events have a big impact on me. I attended A2C leadership camp which is also a life-changing experience. My views are enlightened, my horizon is broadened, and my vision is elevated. I learned enormously from our teachers and classmates.&lt;/p&gt;

&lt;p&gt;Life is pretty interesting. You go through mountains and valleys, but you may enjoy different views at different altitudes. You go through the four seasons, and that’s why your life is colorful. Winter is harsh, but you may enjoy the white snow and more importantly, you believe that the buds are swelling, soon the leaves will unfold, and the flowers will be blossoming. Thank you all for reading this.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The histologic phenotype of lung cancers may be driven by transcriptomic features rather than genomic characteristics</title>
      <link>/publication/2021-01-05-mixed-histology/</link>
      <pubDate>Tue, 05 Jan 2021 00:00:00 -0500</pubDate>
      
      <guid>/publication/2021-01-05-mixed-histology/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Review 2020</title>
      <link>/post/review-2020/</link>
      <pubDate>Thu, 31 Dec 2020 00:00:00 +0000</pubDate>
      
      <guid>/post/review-2020/</guid>
      <description>&lt;p&gt;It is the end of the year again and it is a good time to review my 2020. I wrote &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/post/the-end-of-2019/&#34; target=&#34;_blank&#34;&gt;one&lt;/a&gt; for 2019. It has been a tough year for many of us. It is the same for me. I switched my job from &lt;a href=&#34;https://informatics.fas.harvard.edu/pages/about.html&#34; target=&#34;_blank&#34;&gt;Harvard FAS informatics&lt;/a&gt; to &lt;a href=&#34;https://ds.dfci.harvard.edu/&#34; target=&#34;_blank&#34;&gt;Department of Data Science at Dana-Farber Cancer Institute&lt;/a&gt; during the shutdown because of COVID19 at the end of March and has been working from home since then. I am grateful for my stay in the Harvard FAS informatics group. Tim has been super supportive and the collaboration with Catherine Dulac&amp;rsquo;s lab was exciting. I learned a lot about single-cell analysis.&lt;/p&gt;

&lt;p&gt;It is a weird feeling that I have not been to the office since I joined &lt;a href=&#34;https://liulab-dfci.github.io/&#34; target=&#34;_blank&#34;&gt;Shirley&amp;rsquo;s group&lt;/a&gt;, but I have to say it turned out to play well. I am thankful that Shirley thought of me to join her team to lead the bioinformatics effort of the &lt;a href=&#34;https://cimac-network.org/cidc/&#34; target=&#34;_blank&#34;&gt;Cancer Immunologic Data Commons (CIDC)&lt;/a&gt; project. It is a complicated project and involves many parties. I decided to take the challenge and made the mind to improve myself. It is also my great honor to interact with the &lt;a href=&#34;https://ds.dfci.harvard.edu/knowledge-systems/team/&#34; target=&#34;_blank&#34;&gt;software team&lt;/a&gt; led by Ethan Cerami and James Linsay for this project. I learned tremendously from them on the software side. To be honest, the job is not easy, but the good thing is that I have been learning a lot in many aspects. I learned a lot about cancer immunology, hiring, writing, managing, and communicating.&lt;/p&gt;

&lt;p&gt;Still, I want to list some highlights for 2020.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;My first co-first author computational &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/publication/2020-04-03-kmt2d-lung-cancer/&#34; target=&#34;_blank&#34;&gt;paper&lt;/a&gt; is finally published in &lt;em&gt;Cancer Cell&lt;/em&gt;. It means a lot to me. I was studying cancer molecular biology in my Ph.D. and made the jump to computational biology for my postdoc with &lt;a href=&#34;https://www.jax.org/research-and-faculty/research-labs/the-verhaak-lab&#34; target=&#34;_blank&#34;&gt;Roel Verhaak&lt;/a&gt; when he was in MD Anderson Cancer Center. Computational training in Roel&amp;rsquo;s lab has paved a solid foundation for my work. I then published two other papers on &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/publication/2020-05-29-scclusteval/&#34; target=&#34;_blank&#34;&gt;evaluating single-cell cluster stability&lt;/a&gt; and &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/publication/2020-03-20-kallisto-scatac/&#34; target=&#34;_blank&#34;&gt;fast analysis of single-cell ATAC-seq data&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;I finished one statistics course and one big data course with Grade A from Harvard Extension School.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;We did a five-week intensive bioinformatics training for the new hires in Shirley&amp;rsquo;s group. We hired 5 people in 3 months! I am a big fan of reproducible research. I gave a &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/talk/2020-reproducible-computing/&#34; target=&#34;_blank&#34;&gt;talk on reproducible computing&lt;/a&gt; during the training.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;I did a presentation on &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/talk/2020-maestro-broad-talk/&#34; target=&#34;_blank&#34;&gt;our single-cell analysis pipeline MAESTRO in the Broad seminar&lt;/a&gt; and gave a talk in the &lt;a href=&#34;https://divingintogeneticsandgenomics.rbind.io/talk/2020-maestro-pact-talk/&#34; target=&#34;_blank&#34;&gt;PACT meeting for the CIMAC-CIDC project&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;I had my foot wet on single-cell TCR-seq and BCR-seq analysis. The best way to learn how to analyze a type of NGS data is to analyze the data for a project. I learned a lot by googling and from our local experts Li Song in the same group.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;I started to invest myself in career development. I had someone coach my communication skills and took a leadership course.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In the coming 2021, I want to make our CIDC bioinformatics team more successful, to make all the team members more sucessful. Of course, I should be writing more papers. I can see two co-first author papers, one first-author paper, and one senior author paper coming out. I always want to enhance my statistics background and I plan to go through &lt;a href=&#34;https://www.middleprofessor.com/files/applied-biostatistics_bookdown/_book/&#34; target=&#34;_blank&#34;&gt;Elements of Statistical Modeling for Experimental Biology&lt;/a&gt;. Most importantly, I will continue to try to be a better human, a better husband, a better father, and then a better researcher.&lt;/p&gt;

&lt;p&gt;I wish everyone to have a safe and prosperous new year!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>PACT meeting update: single-cell and bulk ATAC-seq analysis pipelines</title>
      <link>/talk/2020-maestro-pact-talk/</link>
      <pubDate>Tue, 10 Nov 2020 11:15:00 -0500</pubDate>
      
      <guid>/talk/2020-maestro-pact-talk/</guid>
      <description>&lt;p&gt;In the joint &lt;a href=&#34;https://www.niaid.nih.gov/clinical-trials/pact&#34; target=&#34;_blank&#34;&gt;Partnership for Access to Clinical Trials (PACT)&lt;/a&gt; and &lt;a href=&#34;https://cimac-network.org/&#34; target=&#34;_blank&#34;&gt;CIMAC-CIDC&lt;/a&gt; Network Fall meeting. I presented the update for our bulk ATAC-seq pipeline and the MAESTRO single-cell workflow. I led the discussion of the adoption of single-cell ATAC-seq in the CIMAC trails afterwards.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/img/PACT_1.png&#34; alt=&#34;&#34; /&gt;
&lt;img src=&#34;/img/PACT_2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Evaluating single-cell cluster stability using the Jaccard similarity index</title>
      <link>/publication/2020-05-29-scclusteval/</link>
      <pubDate>Mon, 09 Nov 2020 00:00:00 -0500</pubDate>
      
      <guid>/publication/2020-05-29-scclusteval/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MAESTRO: Model-based Analyses of Single-cell Transcriptome and Regulome</title>
      <link>/talk/2020-maestro-broad-talk/</link>
      <pubDate>Mon, 02 Nov 2020 14:30:00 -0500</pubDate>
      
      <guid>/talk/2020-maestro-broad-talk/</guid>
      <description>&lt;p&gt;I gave a talk on our single-cell RNA-seq and single-cell ATAC-seq analysis tool &lt;a href=&#34;https://github.com/liulab-dfci/MAESTRO&#34; target=&#34;_blank&#34;&gt;MAESTRO&lt;/a&gt; in the &lt;a href=&#34;https://www.broadinstitute.org/epigenomics&#34; target=&#34;_blank&#34;&gt;Broad Institute CC&amp;amp;E Seminar Series&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Enhancer Reprogramming Confers Dependence on Glycolysis and IGF Signaling in KMT2D Mutant Melanoma</title>
      <link>/publication/2020-10-20-kmt2d-melanoma/</link>
      <pubDate>Tue, 20 Oct 2020 00:00:00 -0400</pubDate>
      
      <guid>/publication/2020-10-20-kmt2d-melanoma/</guid>
      <description>&lt;p&gt;More detail can easily be written here using &lt;em&gt;Markdown&lt;/em&gt; and $\rm \LaTeX$ math code.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
