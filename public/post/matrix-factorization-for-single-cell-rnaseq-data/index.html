<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.42" />
  <meta name="author" content="Ming Tang">

  
  
  
  
    
      
    
  
  <meta name="description" content="I am interested in learning more on matrix factorization and its application in scRNAseq data. I want to shout out to this paper: Enter the Matrix: Factorization Uncovers Knowledge from Omics by Elana J. Fertig group.
A matrix is decomposed to two matrices: the amplitude matrix and the pattern matrix. You can then do all sorts of things with the decomposed matrices. Single cell matrix is no special, one can use the matrix factorization techniques to derive interesting biological insights.">

  
  <link rel="alternate" hreflang="en-us" href="/post/matrix-factorization-for-single-cell-rnaseq-data/">

  


  

  
  
  <meta name="theme-color" content="#328cc1">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/custom.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-84019592-2', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="DNA confesses Data speak">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="DNA confesses Data speak">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/matrix-factorization-for-single-cell-rnaseq-data/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@https://twitter.com/tangming2005">
  <meta property="twitter:creator" content="@https://twitter.com/tangming2005">
  
  <meta property="og:site_name" content="DNA confesses Data speak">
  <meta property="og:url" content="/post/matrix-factorization-for-single-cell-rnaseq-data/">
  <meta property="og:title" content="Matrix Factorization for single-cell RNAseq data | DNA confesses Data speak">
  <meta property="og:description" content="I am interested in learning more on matrix factorization and its application in scRNAseq data. I want to shout out to this paper: Enter the Matrix: Factorization Uncovers Knowledge from Omics by Elana J. Fertig group.
A matrix is decomposed to two matrices: the amplitude matrix and the pattern matrix. You can then do all sorts of things with the decomposed matrices. Single cell matrix is no special, one can use the matrix factorization techniques to derive interesting biological insights.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2021-08-26T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2021-08-26T00:00:00&#43;00:00">
  

  
  

  <title>Matrix Factorization for single-cell RNAseq data | DNA confesses Data speak</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">DNA confesses Data speak</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>Talks &amp; Teachings</span>
            
          </a>
        </li>

        
        

        
        
        
        
        

        <li class="nav-item">
          <a href="/#cv">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Matrix Factorization for single-cell RNAseq data</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2021-08-26 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Aug 26, 2021
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Ming Tang">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    14 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="/post/matrix-factorization-for-single-cell-rnaseq-data/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/bioinformatics/">bioinformatics</a
    >, 
    
    <a href="/categories/scrnaseq/">scRNAseq</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Matrix%20Factorization%20for%20single-cell%20RNAseq%20data&amp;url=%2fpost%2fmatrix-factorization-for-single-cell-rnaseq-data%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fmatrix-factorization-for-single-cell-rnaseq-data%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fmatrix-factorization-for-single-cell-rnaseq-data%2f&amp;title=Matrix%20Factorization%20for%20single-cell%20RNAseq%20data"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fmatrix-factorization-for-single-cell-rnaseq-data%2f&amp;title=Matrix%20Factorization%20for%20single-cell%20RNAseq%20data"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Matrix%20Factorization%20for%20single-cell%20RNAseq%20data&amp;body=%2fpost%2fmatrix-factorization-for-single-cell-rnaseq-data%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>I am interested in learning more on matrix factorization and its application in scRNAseq data.
I want to shout out to this paper: <a href="https://www.sciencedirect.com/science/article/pii/S0168952518301240">Enter the Matrix: Factorization Uncovers Knowledge from Omics</a> by <a href="https://fertiglab.com/">Elana J. Fertig group</a>.</p>
<p><img src="/img/posts_img/matrix_factorization.png" /></p>
<p>A matrix is decomposed to two matrices: the amplitude matrix and the pattern matrix. You can then do all sorts of things with the decomposed matrices. Single cell matrix is no special, one can use the matrix factorization techniques to derive interesting biological insights.</p>
<p>Load the libraries.</p>
<pre class="r"><code>library(dplyr)
library(Seurat)
library(patchwork)
library(ggplot2)
library(ComplexHeatmap)
set.seed(1234)</code></pre>
<p>Let’s use some small data for demonstration. The 3k pbmc 10x genomics data are downloaded from <a href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html">Seurat tutorial</a>.</p>
<pre class="r"><code># Load the PBMC dataset
pbmc.data &lt;- Read10X(data.dir = &quot;~/blog_data/filtered_gene_bc_matrices/hg19/&quot;)
# Initialize the Seurat object with the raw (non-normalized data).
pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = &quot;pbmc3k&quot;, min.cells = 3, min.features = 200)

## routine processing
pbmc&lt;- pbmc %&gt;% 
  NormalizeData(normalization.method = &quot;LogNormalize&quot;, scale.factor = 10000) %&gt;%
  FindVariableFeatures(selection.method = &quot;vst&quot;, nfeatures = 2000) %&gt;%
  ScaleData() %&gt;%
  RunPCA(verbose = FALSE) %&gt;%
  FindNeighbors(dims = 1:10, verbose = FALSE) %&gt;%
  FindClusters(resolution = 0.5, verbose = FALSE) %&gt;%
  RunUMAP(dims = 1:10, verbose = FALSE)

## the annotation borrowed from Seurat tutorial
new.cluster.ids &lt;- c(&quot;Naive CD4 T&quot;, &quot;CD14+ Mono&quot;, &quot;Memory CD4 T&quot;, &quot;B&quot;, &quot;CD8 T&quot;, &quot;FCGR3A+ Mono&quot;, 
    &quot;NK&quot;, &quot;DC&quot;, &quot;Platelet&quot;)
names(new.cluster.ids) &lt;- levels(pbmc)
pbmc &lt;- RenameIdents(pbmc, new.cluster.ids)</code></pre>
<div id="pca" class="section level3">
<h3>PCA</h3>
<pre class="r"><code>p1&lt;- DimPlot(pbmc, reduction = &quot;pca&quot;, label = TRUE)
p1</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><code>PCA</code> performs pretty well in terms of seprating different cell types.</p>
<p>Let’s reproduce this plot by SVD.
in a svd analysis, a mxn matrix X is decomposed by <code>X = U*D*V</code>:</p>
<ul>
<li>U is an m×p orthogonal matrix</li>
<li>D is an n×p diagonal matrix</li>
<li>V is an p×p orthogonal matrix</li>
</ul>
<p>with p=min(m,n)</p>
<p>PCs: <strong>Z = XV or Z = UD (U are un-scaled PCs)</strong></p>
<p>Some facts of PCA:</p>
<p><strong>k th column of Z, Z(k), is the k th PC.(the k th pattern)</strong></p>
<p>PC loadings: k th column of V, V(k) is the k th PC loading (feature weights). aka. <strong>the k th column of V encodes the associated k th pattern in feature space.</strong></p>
<p>PC loadings: k th column of U, U(k) is the k th PC loading (observation weights). aka. <strong>the k th column of U encodes the associated k th pattern in observation space.</strong></p>
<p>Diagnal matrix: D diagnals in D: <strong>d(k) gives the strength of the k th pattern.</strong></p>
<p>Variance explained by k th PC: d(k)^2 Total variance of the data: <code>sum(d(k1)^2 + d(k2)^2 + …..d(k)^2+….)</code></p>
<p>proportion of variance explained by k th PC: <code>d(k)^2 / sum(d(k1)^2 + d(k2)^2 + …..d(k)^2+….)</code></p>
<p>Take a look my old post <a href="https://divingintogeneticsandgenomics.rbind.io/post/pca-in-action/" class="uri">https://divingintogeneticsandgenomics.rbind.io/post/pca-in-action/</a>
and <a href="http://genomicsclass.github.io/book/pages/svd.html" class="uri">http://genomicsclass.github.io/book/pages/svd.html</a> from Rafa.</p>
<pre class="r"><code>## use the scaled data (centered and scaled)
mat&lt;- pbmc[[&quot;RNA&quot;]]@scale.data

## 2000 most variable genes x 2700 cells
dim(mat)</code></pre>
<pre><code>#&gt; [1] 2000 2700</code></pre>
<pre class="r"><code>## for large matrix,use irlba::irlba for approximated calculation.
## this matrix is scaled and centered.
sv&lt;- svd(t(mat))
U&lt;- sv$u
V&lt;- sv$v
D&lt;- sv$d

## U are un-scaled PC, Z is scaled PC
Z&lt;- t(mat)%*%V

## PCs
Z[1:6, 1:6]</code></pre>
<pre><code>#&gt;                      [,1]        [,2]       [,3]       [,4]       [,5]
#&gt; AAACATACAACCAC -4.6060466 -0.60371951 -0.6052429 -1.7231935  0.7443433
#&gt; AAACATTGAGCTAC -0.1670809  4.54421712  6.4518867  6.8597974  0.8011412
#&gt; AAACATTGATCAGC -2.6455614 -4.00971883 -0.3723479 -0.9960236  4.9837032
#&gt; AAACCGTGCTTCCG 11.8569587  0.06340912  0.6226992 -0.2431955 -0.2919980
#&gt; AAACCGTGTATGCG -3.0531940 -6.00216498  0.8234015  2.0463393 -8.2465179
#&gt; AAACGCACTGGTAC -2.6832368  1.37196098 -0.5872163 -2.2090349  2.5291571
#&gt;                      [,6]
#&gt; AAACATACAACCAC  1.2945554
#&gt; AAACATTGAGCTAC  0.5033887
#&gt; AAACATTGATCAGC -0.2512450
#&gt; AAACCGTGCTTCCG -1.5098393
#&gt; AAACCGTGTATGCG  1.1540471
#&gt; AAACGCACTGGTAC  0.2604137</code></pre>
<pre class="r"><code>## this is the almost the same as PCs in the seurat reduction slot. Note some signs are opposite
pbmc@reductions$pca@cell.embeddings[1:6, 1:6]</code></pre>
<pre><code>#&gt;                       PC_1        PC_2       PC_3       PC_4       PC_5
#&gt; AAACATACAACCAC   4.6060466 -0.60371951 -0.6052429 -1.7231935 -0.7443433
#&gt; AAACATTGAGCTAC   0.1670809  4.54421712  6.4518867  6.8597974 -0.8011412
#&gt; AAACATTGATCAGC   2.6455614 -4.00971883 -0.3723479 -0.9960236 -4.9837032
#&gt; AAACCGTGCTTCCG -11.8569587  0.06340912  0.6226992 -0.2431955  0.2919980
#&gt; AAACCGTGTATGCG   3.0531940 -6.00216498  0.8234015  2.0463393  8.2465179
#&gt; AAACGCACTGGTAC   2.6832368  1.37196098 -0.5872163 -2.2090349 -2.5291571
#&gt;                      PC_6
#&gt; AAACATACAACCAC  1.2945554
#&gt; AAACATTGAGCTAC  0.5033887
#&gt; AAACATTGATCAGC -0.2512450
#&gt; AAACCGTGCTTCCG -1.5098393
#&gt; AAACCGTGTATGCG  1.1540471
#&gt; AAACGCACTGGTAC  0.2604137</code></pre>
<pre class="r"><code>## make the PCA plot using PC1 and PC2
cell_annotation&lt;- Idents(pbmc) %&gt;%
  tibble::enframe(name = &quot;cell&quot;, value= &quot;celltype&quot;)

p2&lt;- Z[, 1:2] %&gt;%
  as.data.frame() %&gt;%
  dplyr::rename(PC_1 = V1, PC_2 = V2) %&gt;%
  tibble::rownames_to_column(var = &quot;cell&quot;) %&gt;%
  left_join(cell_annotation) %&gt;%
  ggplot(aes(x= PC_1, y = PC_2)) +
  geom_point(aes(color = celltype), size = 0.5) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3)))
  

p1/p2</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-5-1.png" width="672" />
If we flip the PC_1 coordinates, those two plots are the same.</p>
<p>Note that <code>X = U*D*V</code>, a matrix X is decomposed into 3 matrices.
U*D is the pattern matrix (Z matrix), and V is the amplitude matrix.</p>
<pre class="r"><code>dim(Z)</code></pre>
<pre><code>#&gt; [1] 2700 2000</code></pre>
<pre class="r"><code>dim(V)</code></pre>
<pre><code>#&gt; [1] 2000 2000</code></pre>
<p>In single-cell RNAseq analysis, the <code>Z</code> matrix is used to construct the k-nearest neighbor graph and clusters are detected using Louvain method in the graph. One can use any other clustering algorithms to cluster the cells (e.g., k-means, hierarchical clustering) in this PC space.</p>
<pre class="r"><code># devtools::install_github(&quot;crazyhottommy/scclusteval&quot;)
library(scclusteval)
kmeans_res&lt;- kmeans(Z, centers = 9)
kmeans_clusters&lt;- kmeans_res$cluster 

## check how the k-means clusters corresponds to the graph-based clusters
PairWiseJaccardSetsHeatmap(Idents(pbmc), kmeans_clusters)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>We see pretty nice 1 to 1 cluster matches. K-means is fast, but it does require a pre-defined K. I used 9 here because the graph-based method generates 9 clusters.</p>
<p>Let’s see what are the genes contributing to the first PC.
From the PCA plot, we see PC1 is seprating the monocytes/DC with the T cells/B cells.</p>
<pre class="r"><code>feature_loadings&lt;- V[,1]
names(feature_loadings)&lt;- rownames(mat)

feature_loadings&lt;- tibble::enframe(feature_loadings, name = &quot;gene&quot;, value = &quot;feature_loading&quot;)
feature_loadings %&gt;%
  arrange(desc(abs(feature_loading))) %&gt;%
  head()</code></pre>
<pre><code>#&gt; # A tibble: 6 x 2
#&gt;   gene   feature_loading
#&gt;   &lt;chr&gt;            &lt;dbl&gt;
#&gt; 1 CST3             0.131
#&gt; 2 TYROBP           0.125
#&gt; 3 LST1             0.124
#&gt; 4 AIF1             0.123
#&gt; 5 FTL              0.121
#&gt; 6 FCN1             0.120</code></pre>
<p><a href="https://www.proteinatlas.org/ENSG00000101439-CST3">CST3</a> is on the top, and it is a marker for monocytes and pDCs. which makes perfect sense!
others such as <a href="https://www.proteinatlas.org/ENSG00000011600-TYROBP">TYROBP</a>, <a href="https://www.proteinatlas.org/ENSG00000204482-LST1">LST1</a> etc are all myeloid lineage markers.
Those genes are highly expressed in the myeloid cells.</p>
<pre class="r"><code>DimPlot(pbmc, reduction = &quot;pca&quot;, label = TRUE) + NoLegend()</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>FeaturePlot(pbmc, features = c(&quot;CST3&quot;, &quot;TYROBP&quot;, &quot;LST1&quot;, &quot;AIF1&quot;), reduction = &quot;pca&quot;)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>DimPlot(pbmc, reduction = &quot;umap&quot;, label = TRUE) + NoLegend()</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<pre class="r"><code>FeaturePlot(pbmc, features = c(&quot;CST3&quot;, &quot;TYROBP&quot;, &quot;LST1&quot;, &quot;AIF1&quot;), reduction = &quot;umap&quot;)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-9-4.png" width="672" /></p>
</div>
<div id="find-gene-modules" class="section level3">
<h3>find gene modules</h3>
<p>For PC1, let’s check the gene loading distribution:</p>
<pre class="r"><code>feature_loadings %&gt;%
  ggplot(aes(x=feature_loading)) +
  geom_histogram(col=&quot;white&quot;, bins = 100) +
  theme_classic(base_size = 14) +
  ggtitle(&quot;gene loadings for PC1&quot;)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>## take the genes greater than 3 sd away from mean
cutoff&lt;- mean(feature_loadings$feature_loading) + 3* sd(feature_loadings$feature_loading)

## 55 genes
genes_module_PC1&lt;- feature_loadings %&gt;%
  filter(feature_loading &gt; cutoff) %&gt;%
  arrange(desc(feature_loading)) %&gt;%
  pull(gene)

genes_module_PC1</code></pre>
<pre><code>#&gt;  [1] &quot;CST3&quot;     &quot;TYROBP&quot;   &quot;LST1&quot;     &quot;AIF1&quot;     &quot;FTL&quot;      &quot;FCN1&quot;    
#&gt;  [7] &quot;LYZ&quot;      &quot;FTH1&quot;     &quot;S100A9&quot;   &quot;FCER1G&quot;   &quot;TYMP&quot;     &quot;CFD&quot;     
#&gt; [13] &quot;LGALS1&quot;   &quot;CTSS&quot;     &quot;S100A8&quot;   &quot;SERPINA1&quot; &quot;LGALS2&quot;   &quot;SPI1&quot;    
#&gt; [19] &quot;IFITM3&quot;   &quot;PSAP&quot;     &quot;CFP&quot;      &quot;SAT1&quot;     &quot;IFI30&quot;    &quot;COTL1&quot;   
#&gt; [25] &quot;S100A11&quot;  &quot;NPC2&quot;     &quot;LGALS3&quot;   &quot;GSTP1&quot;    &quot;PYCARD&quot;   &quot;NCF2&quot;    
#&gt; [31] &quot;CDA&quot;      &quot;S100A6&quot;   &quot;GPX1&quot;     &quot;MS4A6A&quot;   &quot;OAZ1&quot;     &quot;FCGRT&quot;   
#&gt; [37] &quot;APOBEC3A&quot; &quot;TNFSF13B&quot; &quot;S100A4&quot;   &quot;CEBPB&quot;    &quot;HLA-DRB1&quot; &quot;TIMP1&quot;   
#&gt; [43] &quot;HLA-DRA&quot;  &quot;AP2S1&quot;    &quot;FGR&quot;      &quot;FPR1&quot;     &quot;MS4A7&quot;    &quot;MAFB&quot;    
#&gt; [49] &quot;SRGN&quot;     &quot;ALDH2&quot;    &quot;TALDO1&quot;   &quot;FGL2&quot;     &quot;HLA-DRB5&quot; &quot;C1orf162&quot;
#&gt; [55] &quot;IFI6&quot;</code></pre>
<p>To make sense of the gene list, one can do gene set over-representation test or run GSEA (e.g., <code>fgsea</code>) which uses all genes ranked by some metric. This is just a very simple way to find the gene modules.</p>
</div>
<div id="correspondence-analysis-coa" class="section level3">
<h3>Correspondence analysis (COA)</h3>
<p>Follow <a href="https://aedin.github.io/PCAworkshop/articles/c_COA.html" class="uri">https://aedin.github.io/PCAworkshop/articles/c_COA.html</a> by Aedin!</p>
<blockquote>
<p>Correspondence analysis (COA) is considered a dual-scaling method, because both the rows and columns are scaled prior to singular value decomposition (SVD).</p>
</blockquote>
<blockquote>
<p>Correspondence analysis (CA) is a matrix factorization method, and is similar to principal components analysis (PCA). Whereas PCA is designed for application to continuous, approximately normally distributed data, CA is appropriate for non-negative, count-based data that are in the same additive scale.</p>
</blockquote>
<p>There are many implementations in R for COA. <a href="https://www.bioconductor.org/packages/devel/bioc/html/corral.html"><code>coral</code></a> which uses sparse matrix and <code>irlba::irlba()</code> for faster processing is better for scRNAseq data. I will use <code>ade4</code> package to demonstrate.</p>
<p>papers to read:</p>
<ul>
<li><p><a href="https://academic.oup.com/bib/article/17/4/628/2240645?login=true">Dimension reduction techniques for the integrative analysis of multi-omics data</a></p></li>
<li><p><a href="https://www.frontiersin.org/articles/10.3389/fonc.2020.00973/full">Impact of Data Preprocessing on Integrative Matrix Factorization of Single Cell Data</a></p></li>
<li><p><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1006907">Ten quick tips for effective dimensionality reduction</a></p></li>
<li><p><a href="https://link.springer.com/article/10.1186%2Fs13059-019-1861-6">Feature selection and dimension reduction for single-cell RNA-Seq based on a multinomial model</a></p></li>
<li><p><a href="https://www.biorxiv.org/content/10.1101/2021.06.24.449781v2">Transformation and Preprocessing of Single-Cell RNA-Seq Data</a></p></li>
</ul>
<pre class="r"><code>## I also tried the raw count matrix, but it did work well. so I changed to log normalized count
logNorm_mat&lt;- pbmc@assays$RNA@data[VariableFeatures(pbmc), ]
coa_ade4&lt;-ade4::dudi.coa(as.matrix(logNorm_mat),scannf = FALSE, n=10)</code></pre>
<p>The resulting row and column scores and coordinates are in the objects <code>li</code>, <code>co</code>, <code>l1</code>, <code>c1</code>, where <code>l</code> here refers to “lines” or rows, and <code>c</code> is columns.</p>
<pre class="r"><code>head(coa_ade4$li)  #Row coordinates dims =c(2000,10)</code></pre>
<pre><code>#&gt;              Axis1      Axis2       Axis3       Axis4        Axis5        Axis6
#&gt; PPBP   -5.75332076  1.4086401 -0.02455373  0.10531845  1.274407843 -1.078108505
#&gt; S100A9 -0.30571958 -1.1248205  0.19158402 -0.05478944  0.050216226 -0.047159284
#&gt; IGLL5   0.12630917  0.2539361 -2.33635148  0.93389553  0.082541193 -0.099580517
#&gt; LYZ    -0.18351075 -0.6772280  0.08475204 -0.07088775  0.041890836 -0.027217635
#&gt; GNLY    0.24866136  0.5352580  0.84548909  1.33722681 -0.001407911  0.026953970
#&gt; FTL    -0.04993657 -0.1430851 -0.03623064 -0.04339615  0.028197300 -0.002100519
#&gt;             Axis7       Axis8        Axis9      Axis10
#&gt; PPBP   0.12711171  0.19002380 -0.289682810 -0.01022194
#&gt; S100A9 0.13024095 -0.42532765  0.029976165 -0.02297505
#&gt; IGLL5  0.02929640 -0.17589290  0.114116748 -0.17542508
#&gt; LYZ    0.07102446 -0.22002186 -0.013246003 -0.03274752
#&gt; GNLY   0.08571882 -0.08868238 -0.057177230 -0.35642891
#&gt; FTL    0.07062523 -0.06456654  0.006058369  0.02374175</code></pre>
<pre class="r"><code>head(coa_ade4$co) #Col coordinates dims=c(2700,10)</code></pre>
<pre><code>#&gt;                      Comp1       Comp2       Comp3       Comp4       Comp5
#&gt; AAACATACAACCAC  0.15514596  0.29557202  0.09342970 -0.14623715  0.01891340
#&gt; AAACATTGAGCTAC  0.05666115  0.04572627 -0.54523299  0.20399405 -0.07800370
#&gt; AAACATTGATCAGC  0.11930802  0.24226962  0.10890364 -0.19520281  0.02452506
#&gt; AAACCGTGCTTCCG -0.14910542 -0.52464123  0.04523697  0.06184439 -0.00553116
#&gt; AAACCGTGTATGCG  0.13363624  0.27591478  0.43934781  0.74839410  0.02411396
#&gt; AAACGCACTGGTAC  0.09223307  0.14078183 -0.10464046 -0.27672346 -0.02813241
#&gt;                      Comp6        Comp7       Comp8        Comp9       Comp10
#&gt; AAACATACAACCAC -0.03226091 -0.027990323 -0.08706780 -0.005239057  0.085160061
#&gt; AAACATTGAGCTAC -0.05874295  0.005084571  0.03213915  0.057400168 -0.002495395
#&gt; AAACATTGATCAGC -0.01989865 -0.033110863  0.07453705 -0.011871229 -0.051224956
#&gt; AAACCGTGCTTCCG -0.04012875 -0.133776910  0.15420002 -0.032286422  0.019314137
#&gt; AAACCGTGTATGCG -0.02362779  0.098752385 -0.07288541  0.007020799 -0.295566494
#&gt; AAACGCACTGGTAC -0.08895839 -0.131280568 -0.09899092  0.037054361  0.003949727</code></pre>
<pre class="r"><code>head(coa_ade4$l1)  #Row scores dims =c(2000 10)</code></pre>
<pre><code>#&gt;                RS1        RS2         RS3        RS4          RS5        RS6
#&gt; PPBP   -13.7542550  3.5432621 -0.07971282  0.4123288  6.668566976 -6.0620900
#&gt; S100A9  -0.7308727 -2.8293485  0.62197063 -0.2145043  0.262765385 -0.2651717
#&gt; IGLL5    0.3019627  0.6387451 -7.58488119  3.6562636  0.431911558 -0.5599307
#&gt; LYZ     -0.4387125 -1.7034842  0.27514445 -0.2775303  0.219201290 -0.1530419
#&gt; GNLY     0.5944657  1.3463761  2.74484998  5.2353326 -0.007367147  0.1515593
#&gt; FTL     -0.1193815 -0.3599131 -0.11762146 -0.1698988  0.147547414 -0.0118110
#&gt;              RS7        RS8         RS9        RS10
#&gt; PPBP   0.7271594  1.1611856 -1.87348843 -0.06832901
#&gt; S100A9 0.7450606 -2.5990658  0.19386721 -0.15357770
#&gt; IGLL5  0.1675939 -1.0748354  0.73803623 -1.17263623
#&gt; LYZ    0.4063048 -1.3444959 -0.08566691 -0.21890216
#&gt; GNLY   0.4903658 -0.5419148 -0.36978680 -2.38256380
#&gt; FTL    0.4040210 -0.3945492  0.03918177  0.15870273</code></pre>
<pre class="r"><code>head(coa_ade4$c1)  #Col scores dims=c(2700,10)</code></pre>
<pre><code>#&gt;                       CS1        CS2        CS3        CS4         CS5
#&gt; AAACATACAACCAC  0.3709018  0.7434753  0.3033162 -0.5725282  0.09896777
#&gt; AAACATTGAGCTAC  0.1354578  0.1150188 -1.7700793  0.7986504 -0.40816829
#&gt; AAACATTGATCAGC  0.2852254  0.6093996  0.3535518 -0.7642321  0.12833176
#&gt; AAACCGTGCTTCCG -0.3564609 -1.3196709  0.1468602  0.2421249 -0.02894278
#&gt; AAACCGTGTATGCG  0.3194793  0.6940299  1.4263269  2.9300130  0.12618059
#&gt; AAACGCACTGGTAC  0.2204983  0.3541195 -0.3397115 -1.0833909 -0.14720788
#&gt;                       CS6         CS7        CS8         CS9        CS10
#&gt; AAACATACAACCAC -0.1813997 -0.16012235 -0.5320485 -0.03388297  0.56925595
#&gt; AAACATTGAGCTAC -0.3303054  0.02908696  0.1963939  0.37122863 -0.01668057
#&gt; AAACATTGATCAGC -0.1118880 -0.18941507  0.4554764 -0.07677574 -0.34241534
#&gt; AAACCGTGCTTCCG -0.2256397 -0.76528852  0.9422759 -0.20880852  0.12910615
#&gt; AAACCGTGTATGCG -0.1328566  0.56492608 -0.4453836  0.04540617 -1.97572644
#&gt; AAACGCACTGGTAC -0.5002036 -0.75100786 -0.6049076  0.23964458  0.02640211</code></pre>
<pre class="r"><code>sapply(list(li=coa_ade4$li,  l1=coa_ade4$l1, co=coa_ade4$co, c1=coa_ade4$c1), dim)</code></pre>
<pre><code>#&gt;        li   l1   co   c1
#&gt; [1,] 2000 2000 2700 2700
#&gt; [2,]   10   10   10   10</code></pre>
<p>Visualization</p>
<pre class="r"><code>coa_ade4$co[,c(1,2)] %&gt;%
  as.data.frame() %&gt;%
  tibble::rownames_to_column(var = &quot;cell&quot;) %&gt;%
  left_join(cell_annotation) %&gt;%
  ggplot(aes(x= Comp1, y = Comp2)) +
  geom_point(aes(color = celltype), size = 0.5) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3)))</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Component 1 seems to separate Platelet with others.</p>
<pre class="r"><code>coa_ade4$co[,c(2,3)] %&gt;%
  as.data.frame() %&gt;%
  tibble::rownames_to_column(var = &quot;cell&quot;) %&gt;%
  left_join(cell_annotation) %&gt;%
  ggplot(aes(x= Comp2, y = Comp3)) +
  geom_point(aes(color = celltype), size = 0.5) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3)))</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-14-1.png" width="672" />
Component 2 seems to separate the CD14+ and FCGR3A/CD16+ monocytes with others, and component 3 seems to separate the B cells with others.</p>
<p>Why use COA rather than PCA?</p>
<blockquote>
<p>scRNAseq data are counts (Poisson), so correspondence analysis is more appropriate than PCA. it’s exactly the same as SVD on Pearson residuals from a rank-1 Poisson model.</p>
</blockquote>
<p>Read more at:</p>
<ul>
<li><a href="https://www.biorxiv.org/content/10.1101/2020.12.01.405886v3">Analytic Pearson residuals for normalization of single-cell RNA-seq UMI data</a></li>
</ul>
</div>
<div id="non-negative-matrix-factorization-nmf" class="section level3">
<h3>Non-negative matrix factorization (NMF)</h3>
<p>RNAseq counts are non-negative. NMF can be used too! I will use this <a href="https://cran.r-project.org/web/packages/RcppML/vignettes/RcppML.html"><code>RcppML</code></a> package
which supports sparse matrix.</p>
<pre class="r"><code>## rank 30, RcppML::nmf can take sparse matrix as input
## the {NMF} R package needs a dense matrix
## remember to set the seed to make it reproducible 
model &lt;- RcppML::nmf(logNorm_mat, 30, verbose = F, seed = 1234)

w &lt;- model$w
d &lt;- model$d
h &lt;- model$h

## amplitude matrix
dim(w)</code></pre>
<pre><code>#&gt; [1] 2000   30</code></pre>
<pre class="r"><code>rownames(w)&lt;- rownames(logNorm_mat)
colnames(w)&lt;- paste0(&quot;component&quot;, 1:30)

## pattern matrix
dim(h)</code></pre>
<pre><code>#&gt; [1]   30 2700</code></pre>
<pre class="r"><code>rownames(h)&lt;- paste0(&quot;component&quot;, 1:30)
colnames(h)&lt;- colnames(logNorm_mat)</code></pre>
<p>Extra papers to read:</p>
<ul>
<li><a href="https://www.biorxiv.org/content/10.1101/2021.02.09.430550v2">scPNMF: sparse gene encoding of single cells to facilitate gene selection for targeted gene profiling</a></li>
</ul>
<p>The <a href="https://htmlpreview.github.io/?https://github.com/JSB-UCLA/scPNMF/blob/main/inst/docs/scPNMF.html">documentation</a> looks pretty decent and there are many extra functions in addition to the matrix factorization.</p>
<ul>
<li><p><a href="https://www.biorxiv.org/content/10.1101/2021.04.09.439160v1.full">Nonnegative matrix factorization integrates single-cell multi-omic datasets with partially overlapping features</a></p></li>
<li><p><a href="https://pubmed.ncbi.nlm.nih.gov/20810601/">CoGAPS: an R/C++ package to identify patterns and biological process activity in transcriptomic data</a></p></li>
<li><p><a href="https://www.biorxiv.org/content/10.1101/2020.12.01.406363v3">Single cell profiling reveals novel tumor and myeloid subpopulations in small cell lung cancer</a> The authors have beautifully used (regular) NMF to characterize T cells, including some creative application of factor loadings in downstream analyses.</p></li>
</ul>
<p>Similarly, one can do a k-means clustering using the pattern matrix derived from <code>NMF</code>.</p>
<pre class="r"><code>kmeans_NMF_res&lt;- kmeans(t(h), centers = 9)
kmeans_NMF_clusters&lt;- kmeans_NMF_res$cluster 

## check how the k-means clusters corresponds to the graph-based clusters
PairWiseJaccardSetsHeatmap(Idents(pbmc), kmeans_NMF_clusters)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Naive CD4 and Memory CD4 T cells are mixing (this is assuming the original annotation from Seurat is correct which is not necessary true); CD8T cells split into two clusters. Overall, the agreement is good with the graph-based clustering method.</p>
<pre class="r"><code>nmf_df&lt;- t(h) %&gt;% 
  as.data.frame() %&gt;%
  tibble::rownames_to_column(var= &quot;cell&quot;) %&gt;%
  left_join(cell_annotation) 

ggplot(nmf_df, aes(x= celltype, y = component1)) +
  geom_point(aes(color = celltype)) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3))) +
  xlab(&quot;&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Component 1 is associated with CD14, CD16/FCRG3A monocytes and DCs.</p>
<pre class="r"><code>ggplot(nmf_df, aes(x= celltype, y = component2)) +
  geom_point(aes(color = celltype)) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3))) +
  xlab(&quot;&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Component 2 is associated with CD4, CD8 T cells</p>
<pre class="r"><code>ggplot(nmf_df, aes(x= celltype, y = component9)) +
  geom_point(aes(color = celltype)) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3))) +
  xlab(&quot;&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Component 9 is associated with FCRG3A+ monocytes.</p>
<pre class="r"><code>w %&gt;%
  as.data.frame() %&gt;%
  tibble::rownames_to_column(var=&quot;gene&quot;) %&gt;%
  arrange(desc(component9)) %&gt;%
  pull(gene) %&gt;%
  head()</code></pre>
<pre><code>#&gt; [1] &quot;COTL1&quot;  &quot;IFITM2&quot; &quot;FCGR3A&quot; &quot;PSAP&quot;   &quot;CTSS&quot;   &quot;ARPC1B&quot;</code></pre>
<p>FCGR3A gene (it is known to express in NK cells too) is on the top which makes sense.</p>
<pre class="r"><code>DimPlot(pbmc, reduction = &quot;umap&quot;, label = TRUE) + NoLegend()</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>FeaturePlot(pbmc, features = c(&quot;COTL1&quot;, &quot;IFITM2&quot;, &quot;FCGR3A&quot;, &quot;PSAP&quot;), reduction = &quot;umap&quot;, pt.size = 0.1)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
</div>
<div id="independent-component-analysis-ica" class="section level3">
<h3>Independent component analysis (ICA)</h3>
<blockquote>
<p>The data matrix X is considered to be a linear combination of non-Gaussian (independent) components i.e. X = SA where columns of S contain the independent components and A is a linear mixing matrix. In short ICA attempts to ‘un-mix’ the data by estimating an un-mixing matrix W where XW = S.</p>
</blockquote>
<pre class="r"><code>set.seed(123)
library(fastICA)
## use the log normalized counts as input
logNorm_mat&lt;- pbmc@assays$RNA@data[VariableFeatures(pbmc), ]
ica_res&lt;- fastICA(t(as.matrix(logNorm_mat)), n.comp = 30, alg.typ = &quot;deflation&quot;)


## the pattern matrix
dim(ica_res$S)</code></pre>
<pre><code>#&gt; [1] 2700   30</code></pre>
<pre class="r"><code>ica_df&lt;- ica_res$S %&gt;% 
  as.data.frame() %&gt;%
  tibble::rownames_to_column(var= &quot;cell&quot;) %&gt;%
  left_join(cell_annotation) 
  
## I tricked and plot many of them, and found component 10 is associated with B cells
ggplot(ica_df, aes(x= celltype, y = V10)) +
  geom_point(aes(color = celltype)) +
  theme_classic(base_size = 14) +
  guides(color = guide_legend(override.aes = list(size=3))) +
  xlab(&quot;&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>## the amplitude matrix or weigths matrix
dim(ica_res$A)</code></pre>
<pre><code>#&gt; [1]   30 2000</code></pre>
<pre class="r"><code>ica_res$A[1:6, 1:6]</code></pre>
<pre><code>#&gt;              [,1]        [,2]         [,3]        [,4]         [,5]        [,6]
#&gt; [1,] -0.413376000  0.05376641  0.008726011  0.05786623  0.024026180 -0.03044887
#&gt; [2,] -0.010226956 -0.19660527  0.026852085 -0.28306851  0.087733334 -0.53884708
#&gt; [3,]  0.004566480  0.16617227 -0.031147751 -0.04875053 -0.018871534  0.12570441
#&gt; [4,]  0.004287560  0.22019629  0.016369463  0.25592895 -1.013525472  0.13194196
#&gt; [5,]  0.023103960  1.04656926 -0.019891674  0.99164725  0.008837725  0.58089991
#&gt; [6,] -0.002186554 -0.18356631 -0.034622554 -0.21143961  0.001357102 -0.11419977</code></pre>
<pre class="r"><code>## let&#39;s extract the gene weights for component 12
tibble(gene = rownames(logNorm_mat), weights = ica_res$A[10,]) %&gt;%
  arrange(desc(weights))</code></pre>
<pre><code>#&gt; # A tibble: 2,000 x 2
#&gt;    gene     weights
#&gt;    &lt;chr&gt;      &lt;dbl&gt;
#&gt;  1 HLA-DRA    1.12 
#&gt;  2 CD74       0.982
#&gt;  3 HLA-DPB1   0.897
#&gt;  4 CD79A      0.866
#&gt;  5 HLA-DRB1   0.834
#&gt;  6 CD79B      0.821
#&gt;  7 HLA-DPA1   0.807
#&gt;  8 HLA-DQA1   0.765
#&gt;  9 HLA-DQB1   0.704
#&gt; 10 MS4A1      0.659
#&gt; # … with 1,990 more rows</code></pre>
<p>Ah! what do you see the genes with large values on the top? B-cell markers: CD79A/B, MS4A1, and Class II genes. Makes sense!</p>
<pre class="r"><code># rows are the components, columns are the 2000 genes
Heatmap(ica_res$A, name = &quot;clustering for the amplitude matrix&quot;)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>hierarchical clustering(default in Complexheatmap) can find some gene modules too.</p>
<blockquote>
<p>Briefly, we observe in this example that PCA finds sources of separation in the data, whereas both ICA and NMF find independent sources of variation. ICA can find both over- and underexpression of genes in a single CBP, whereas NMF can find only overexpressed genes in a single CBP. As a result, ICA may better model both repression and activation than NMF, but as a side effect may have greater mixture of CBPs than NMF.</p>
</blockquote>
</div>
<div id="co-expression" class="section level3">
<h3>co-expression</h3>
<pre class="r"><code>Heatmap(cor(t(as.matrix(logNorm_mat)), method = &quot;spearman&quot;), 
        show_column_names = FALSE, 
        show_row_names = FALSE,
        name = &quot;spearman correlation&quot;)</code></pre>
<p><img src="/post/2021-08-26-matrix-factorization-for-single-cell-rnaseq-data.en_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>One can clearly see some genes (red blocks) are co-expressed. Note that single cell matrix is sparse, highly expressed genes are more likely to be highly correlated (Thanks <a href="https://twitter.com/stephaniehicks">Stephanie Hicks</a> for pointing it to me!). use <a href="http://bioconductor.org/packages/release/bioc/html/spqn.html" class="uri">http://bioconductor.org/packages/release/bioc/html/spqn.html</a> to fix this problem.</p>
</div>
<div id="take-home-messages" class="section level3">
<h3>Take home messages</h3>
<ul>
<li><p>One can use different matrix factorization techniques for a single cell count matrix and get the pattern matrix(to cluster the cells) and the amplitude matrix(to find gene modules). Different techniques can give you different results and need to be interpreted biologically.</p></li>
<li><p>Use <code>scPNMF</code> to get the gene modules if you go with <code>NMF</code>.</p></li>
</ul>
<p>There is another twitter thread you may want to read:
<a href="https://twitter.com/David_McGaughey/status/1431612645048832004" class="uri">https://twitter.com/David_McGaughey/status/1431612645048832004</a></p>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/scrnaseq/">scRNAseq</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/single-cell/">single-cell</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/clustered-dotplot-for-single-cell-rnaseq/">clustered dotplot for single-cell RNAseq</a></li>
        
        <li><a href="/post/enhancement-of-scrnaseq-heatmap-using-complexheatmap/">Enhancement of scRNAseq heatmap using complexheatmap</a></li>
        
        <li><a href="/post/dplyr-count-misses-factor-levels-a-case-in-comparing-scrnaseq-cell-type-abundance/">dplyr::count misses factor levels: a case in comparing scRNAseq cell type abundance </a></li>
        
        <li><a href="/post/stacked-violin-plot-for-visualizing-single-cell-data-in-seurat/">stacked violin plot for visualizing single-cell data in Seurat</a></li>
        
        <li><a href="/post/compare-kallisto-bustools-and-cellranger-for-single-nuclei-seqencing-data/">compare kallisto-bustools and cellranger for single nuclei sequencing data</a></li>
        
      </ul>
    </div>
    

    
    <div class="article-widget">
      <div class="post-nav">
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/post/be-careful-when-left-join-tables-with-duplicated-rows/" rel="next">Be careful when left_join tables with duplicated rows</a>
  </div>
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/post/how-to-test-if-two-distributions-are-different/" rel="prev">How to test if two distributions are different </a>
  </div>
  
</div>

    </div>
    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "divingintogeneticsandgenomics" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Ming Tang &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//divingintogeneticsandgenomics.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

